<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Carrito de Compras - MaxiHome</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Bootstrap Icons -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
        <!-- Tus estilos -->
        <link rel="stylesheet" href="/css/estilos.css">
        <!-- CSRF para forms -->
        <meta name="_csrf"       th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    </head>
    <body>
        <!-- Navbar -->
        <div th:replace="fragments/navbar :: navbar"></div>

        <div class="container my-5">

            <!-- Mensaje de error si carrito vacío -->
            <div th:if="${errorCart}" class="alert alert-danger" th:text="${errorCart}"></div>
            <div th:if="${msgOrder}" class="alert alert-success" th:text="${msgOrder}"></div>

            <h2 class="mb-4">Tu Carrito</h2>

            <!-- Carrito vacío -->
            <div th:if="${#lists.isEmpty(items)}" class="text-center">
                <p class="lead">Tu carrito está vacío.</p>
                <a th:href="@{/productos}" class="btn bg-naranja text-white">Seguir comprando</a>


            </div>

            <!-- Lista de ítems -->
            <div th:if="${!#lists.isEmpty(items)}">
                <table class="table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Producto</th>
                            <th>Precio unitario</th>
                            <th>Cantidad</th>
                            <th>Subtotal</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="ci : ${items}">
                            <td th:text="${ci.product.nombre}">Nombre Producto</td>
                            <td>S/ <span th:text="${ci.product.precio}">0.00</span></td>
                            <td>
                                <form th:action="@{/cart/update}" method="post" class="d-flex align-items-center">
                                    <input type="hidden" name="productId" th:value="${ci.product.id}" />
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <input type="number"
                                           name="qty"
                                           th:value="${ci.quantity}"
                                           min="1"
                                           class="form-control form-control-sm me-2"
                                           style="width:80px;" />
                                    <button type="submit" class="btn btn-sm btn-outline-secondary">OK</button>
                                </form>
                            </td>
                            <td>
                                S/ <span th:text="${#numbers.formatDecimal(ci.product.precio * ci.quantity, 1, 'COMMA', 2, 'POINT')}">
                                    0.00
                                </span>
                            </td>
                            <td>
                                <a th:href="@{/cart/remove/{id}(id=${ci.product.id})}"
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('¿Eliminar este producto del carrito?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Total y Checkout -->
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <h4>Total: S/ <span th:text="${total}">0.00</span></h4>
                    <form th:action="@{/cart/checkout}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit"
                                class="btn bg-naranja text-white btn-lg"
                                th:disabled="${#lists.isEmpty(items)}">
                            <i class="bi bi-bag-check-fill me-1"></i> Checkout
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div th:replace="fragments/footer :: footer"></div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
